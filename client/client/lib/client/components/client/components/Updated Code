import { SDK, SchemaEncoder } from "@somnia-chain/streams";
import { createPublicClient, createWalletClient, http, defineChain } from "viem";

export const somniaTestnet = defineChain({
  id: 50312,
  name: 'Somnia Testnet',
  nativeCurrency: { name: 'Somnia Test Token', symbol: 'STT', decimals: 18 },
  rpcUrls: {
    default: { http: ['https://dream-rpc.somnia.network'] },
  },
  blockExplorers: {
    default: { name: 'Shannon Explorer', url: 'https://shannon-explorer.somnia.network' },
  },
});

const publicClient = createPublicClient({ chain: somniaTestnet, transport: http() });
const walletClient = createWalletClient({ chain: somniaTestnet, transport: http() });

export const sdk = new SDK({ public: publicClient, wallet: walletClient });

export const fileSchema = `bytes32 cid, bytes32 iv, bytes wrappedKey, address recipient, uint256 timestamp`;
export async function getSchemaId() {
  return await sdk.streams.computeSchemaId(fileSchema);
}

export async function registerSchema() {
  const txHash = await sdk.streams.registerDataSchemas([
    { schemaName: 'file_metadata', schema: fileSchema, parentSchemaId: '0x0000000000000000000000000000000000000000000000000000000000000000' }
  ]);
  console.log(`Schema registered: ${txHash}`);
}
